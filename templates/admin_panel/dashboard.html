{% extends 'admin_panel/admin_base.html' %}

{% block title %}Dashboard | Barberian Admin{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block admin_content %}
<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
    <!-- Total Appointments -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <div class="p-6 flex items-center">
            <div class="rounded-full bg-primary-100 p-3 mr-4">
                <span class="material-icons-outlined text-primary-400">event_note</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Total Appointments</p>
                <h3 class="text-2xl font-bold text-gray-800">{{ total_appointments }}</h3>
            </div>
        </div>
        <div class="bg-gradient-to-r from-primary-400 to-primary-500 h-1"></div>
    </div>

    <!-- Total Clients -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <div class="p-6 flex items-center">
            <div class="rounded-full bg-success/10 p-3 mr-4">
                <span class="material-icons-outlined text-success">people</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Total Clients</p>
                <h3 class="text-2xl font-bold text-gray-800">{{ total_clients }}</h3>
            </div>
        </div>
        <div class="bg-gradient-to-r from-success to-green-600 h-1"></div>
    </div>

    <!-- Total Staff -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <a href="{% url 'admin_panel:staff' %}" class="block">
            <div class="p-6 flex items-center">
                <div class="rounded-full bg-info/10 p-3 mr-4">
                    <span class="material-icons-outlined text-info">badge</span>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500">Total Staff</p>
                    <h3 class="text-2xl font-bold text-gray-800">{{ total_staff }}</h3>
                </div>
            </div>
            <div class="bg-gradient-to-r from-info to-blue-600 h-1"></div>
        </a>
    </div>

    <!-- Today's Appointments -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <div class="p-6 flex items-center">
            <div class="rounded-full bg-warning/10 p-3 mr-4">
                <span class="material-icons-outlined text-warning">today</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Today's Appointments</p>
                <h3 class="text-2xl font-bold text-gray-800">{{ today_appointments }}</h3>
            </div>
        </div>
        <div class="bg-gradient-to-r from-warning to-amber-600 h-1"></div>
    </div>

    <!-- Pending Appointments -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <div class="p-6 flex items-center">
            <div class="rounded-full bg-danger/10 p-3 mr-4">
                <span class="material-icons-outlined text-danger">pending_actions</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Pending Appointments</p>
                <h3 class="text-2xl font-bold text-gray-800">{{ pending_appointments }}</h3>
            </div>
        </div>
        <div class="bg-gradient-to-r from-danger to-red-600 h-1"></div>
    </div>

    <!-- Total Services -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden transform transition-all duration-300 hover:shadow-card-hover hover:-translate-y-1">
        <div class="p-6 flex items-center">
            <div class="rounded-full bg-secondary-200 p-3 mr-4">
                <span class="material-icons-outlined text-secondary-800">content_cut</span>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-500">Total Services</p>
                <h3 class="text-2xl font-bold text-gray-800">{{ total_services }}</h3>
            </div>
        </div>
        <div class="bg-gradient-to-r from-secondary-700 to-secondary-900 h-1"></div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Appointments Chart -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <div class="p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Appointments Overview</h3>
            <div id="appointments-chart" class="h-64"></div>
        </div>
    </div>

    <!-- Revenue Chart -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <div class="p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Revenue Overview</h3>
            <div id="revenue-chart" class="h-64"></div>
        </div>
    </div>
</div>

<!-- Recent Activity Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Recent Appointments -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Recent Appointments</h3>
            <a href="{% url 'admin_panel:appointments' %}" class="text-primary-400 hover:text-primary-600 text-sm font-medium flex items-center">
                View All
                <span class="material-icons-outlined ml-1" style="font-size: 16px;">arrow_forward</span>
            </a>
        </div>
        <div class="p-6">
            {% if recent_appointments %}
                <div class="space-y-4">
                    {% for appointment in recent_appointments %}
                        <a href="{% url 'admin_panel:appointment_detail' appointment.id %}" class="block p-4 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-medium text-gray-800">{{ appointment.service.name }}</h4>
                                    <p class="text-sm text-gray-600 mt-1">
                                        {{ appointment.client.get_full_name }} with {{ appointment.staff.get_full_name }}
                                    </p>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm text-gray-500">{{ appointment.start_time|date:"M d, Y" }}</span>
                                    <div class="mt-1">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                            {% if appointment.status == 'confirmed' %}bg-green-100 text-green-800
                                            {% elif appointment.status == 'pending' %}bg-yellow-100 text-yellow-800
                                            {% elif appointment.status == 'cancelled' %}bg-red-100 text-red-800
                                            {% elif appointment.status == 'completed' %}bg-green-100 text-green-800
                                            {% elif appointment.status == 'no_show' %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ appointment.status|title }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </a>
                        {% if not forloop.last %}
                            <div class="border-t border-gray-100"></div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <span class="material-icons-outlined text-gray-300 text-5xl mb-3">event_busy</span>
                    <p class="text-gray-500">No recent appointments.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Recent Users -->
    <div class="bg-white rounded-xl shadow-card overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Recent Users</h3>
            <a href="{% url 'admin_panel:users' %}" class="text-primary-400 hover:text-primary-600 text-sm font-medium flex items-center">
                View All
                <span class="material-icons-outlined ml-1" style="font-size: 16px;">arrow_forward</span>
            </a>
        </div>
        <div class="p-6">
            {% if recent_users %}
                <div class="space-y-4">
                    {% for user in recent_users %}
                        <a href="{% url 'admin_panel:user_edit' user.id %}" class="block p-4 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 mr-4">
                                    {{ user.get_full_name|slice:":1" }}
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-medium text-gray-800">{{ user.get_full_name }}</h4>
                                            <p class="text-sm text-gray-600 mt-1">{{ user.email }}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-sm text-gray-500">{{ user.date_joined|date:"M d, Y" }}</span>
                                            <div class="mt-1">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                                    {% if user.role == 'admin' %}bg-red-100 text-red-800
                                                    {% elif user.role == 'staff' %}bg-blue-100 text-blue-800
                                                    {% else %}bg-green-100 text-green-800{% endif %}">
                                                    {{ user.role|title }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                        {% if not forloop.last %}
                            <div class="border-t border-gray-100"></div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8">
                    <span class="material-icons-outlined text-gray-300 text-5xl mb-3">person_off</span>
                    <p class="text-gray-500">No recent users.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block admin_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sample data for charts - in a real application, this would come from the backend
        const appointmentsData = {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            series: [
                {
                    name: 'Completed',
                    data: [30, 40, 35, 50, 49, 60, 70]
                },
                {
                    name: 'Cancelled',
                    data: [10, 15, 12, 8, 7, 5, 6]
                },
                {
                    name: 'Pending',
                    data: [5, 10, 8, 12, 15, 10, 8]
                }
            ]
        };

        const revenueData = {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            series: [
                {
                    name: 'Revenue',
                    data: [1500, 1800, 1600, 2200, 2400, 2800, 3200]
                }
            ]
        };

        // Appointments Chart
        const appointmentsChart = new ApexCharts(document.querySelector("#appointments-chart"), {
            chart: {
                type: 'bar',
                height: 250,
                stacked: true,
                toolbar: {
                    show: false
                },
                fontFamily: 'Inter, sans-serif',
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    borderRadius: 5,
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                show: true,
                width: 2,
                colors: ['transparent']
            },
            xaxis: {
                categories: appointmentsData.categories,
            },
            yaxis: {
                title: {
                    text: 'Appointments'
                }
            },
            fill: {
                opacity: 1
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " appointments"
                    }
                }
            },
            colors: ['#10B981', '#EF4444', '#F59E0B'],
            legend: {
                position: 'top',
                horizontalAlign: 'right',
            },
            series: appointmentsData.series
        });
        appointmentsChart.render();

        // Revenue Chart
        const revenueChart = new ApexCharts(document.querySelector("#revenue-chart"), {
            chart: {
                type: 'area',
                height: 250,
                toolbar: {
                    show: false
                },
                fontFamily: 'Inter, sans-serif',
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            xaxis: {
                categories: revenueData.categories,
            },
            yaxis: {
                title: {
                    text: 'Revenue ($)'
                }
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return "$" + val
                    }
                }
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.3,
                    stops: [0, 90, 100]
                }
            },
            colors: ['#D4AF37'],
            series: revenueData.series
        });
        revenueChart.render();
    });
</script>
{% endblock %}
